{% extends 'base.html' %}

{% block title %}Focus Timer - EduFlow AI{% endblock %}

{% block content %}
<h1><i class="bi bi-stopwatch"></i> Focus Timer</h1>

<!-- Overload Alert -->
{% if overload_status.alert %}
<div class="alert alert-warning">
    <i class="bi bi-exclamation-triangle"></i> {{ overload_status.message }}
    <div class="progress mt-2">
        <div class="progress-bar bg-warning" style="width: {{ overload_status.percentage }}%">
            {{ overload_status.percentage }}%
        </div>
    </div>
</div>
{% endif %}

<!-- Active Session -->
{% if active_session %}
<div class="card border-success mb-4">
    <div class="card-body text-center">
        <h3 class="text-success"><i class="bi bi-play-circle-fill"></i> Active Focus Session</h3>
        <p class="lead">Started: {{ active_session.start_time|time:"g:i A" }}</p>
        <p>Model: {{ active_session.focus_model.name|default:"Custom" }}</p>
        <a href="{% url 'end_focus_session' active_session.pk %}" class="btn btn-danger btn-lg">
            <i class="bi bi-stop-circle"></i> End Session
        </a>
    </div>
</div>
{% else %}
<!-- Focus Model Selection -->
<div class="row mb-4">
    <div class="col-md-12">
        <h4>Choose a Focus Model</h4>
    </div>
    {% for model in focus_models %}
    <div class="col-md-4 mb-3">
        <div class="card focus-model-card {% if model == preference.default_focus_model %}active{% endif %}">
            <div class="card-body text-center">
                <h5>{{ model.name }}</h5>
                <p class="display-6">{{ model.focus_duration }}/{{ model.break_duration }}</p>
                <p class="text-muted">{{ model.description }}</p>
                <form method="post" action="{% url 'start_focus_session' %}">
                    {% csrf_token %}
                    <input type="hidden" name="focus_model" value="{{ model.id }}">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-play-circle"></i> Start
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Today's Stats -->
<div class="card">
    <div class="card-header bg-info text-white">
        <h5 class="mb-0">Today's Focus Time</h5>
    </div>
    <div class="card-body text-center">
        <h2 class="display-4 text-primary">{{ daily_minutes }} minutes</h2>
        <p class="lead">({{ daily_minutes|floatformat:0|add:"0"|floatformat:0 }} min = approx. {{ daily_minutes|floatformat:0|add:"0"|floatformat:0|slice:"-2:"|add:"60"|floatformat:0|slice:"-2:" }} hours)</p>
    </div>
</div>
{% endblock %}
